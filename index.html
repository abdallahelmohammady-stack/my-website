<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cybersecurity Learning Roadmap">
    <title>CyberPentest Roadmap</title>
    <link rel="icon" href="favicon.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Orbitron', 'monospace'],
                    },
                    colors: {
                        cyber: {
                            cyan: '#00f3ff',
                            red: '#ff003c',
                            purple: '#bc13fe',
                            dark: '#050505',
                        }
                    },
                    animation: {
                        'scanline': 'scanline 6s linear infinite',
                    },
                    keyframes: {
                        scanline: {
                            '0%': { top: '-10%', opacity: '0' },
                            '50%': { opacity: '0.3', boxShadow: '0 0 20px rgba(0, 243, 255, 0.2)' },
                            '100%': { top: '110%', opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { transition: background-color 0.3s ease, color 0.3s ease; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 243, 255, 0.4); }
        .dark ::-webkit-scrollbar-track { background: #000; }
        .dark ::-webkit-scrollbar-thumb { background: #333; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }

        #matrix-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.15;
        }
        .scan-beam {
            position: fixed; left: 0; width: 100%; height: 80px;
            background: linear-gradient(to bottom, transparent, rgba(0, 243, 255, 0.08), transparent);
            z-index: 1; pointer-events: none; animation: scanline 8s linear infinite;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 70%, rgba(0,0,0,0.7) 100%);
            z-index: 2; pointer-events: none;
        }
        footer {
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 50;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px);
            border-top: 1px solid rgba(0,0,0,0.08); box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        .dark footer {
            background: rgba(0, 0, 0, 0.95); border-top: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }
        main { padding-bottom: 140px; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
        
        .img-upload-area {
            border: 2px dashed #cbd5e1; border-radius: 12px; padding: 20px;
            text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .img-upload-area:hover { border-color: #06b6d4; background: rgba(6, 182, 212, 0.05); }
        .img-upload-area.has-image { border-style: solid; border-color: #06b6d4; }
        .dark .img-upload-area { border-color: #374151; }
        .dark .img-upload-area:hover { border-color: #06b6d4; background: rgba(6, 182, 212, 0.1); }

        /* أزرار التحريك */
        .move-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: #e2e8f0;
            color: #475569;
            transition: all 0.2s;
            border: 1px solid #cbd5e1;
        }
        .move-btn:hover:not(:disabled) {
            background: #06b6d4;
            color: white;
            border-color: #06b6d4;
        }
        .move-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .dark .move-btn {
            background: #1f2937;
            color: #9ca3af;
            border-color: #374151;
        }
        .dark .move-btn:hover:not(:disabled) {
            background: #06b6d4;
            color: white;
            border-color: #06b6d4;
        }

        .reorder-controls {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-right: 12px;
            padding: 4px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
        }
        .dark .reorder-controls {
            background: rgba(255,255,255,0.05);
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 dark:bg-[#020202] dark:text-white min-h-screen selection:bg-cyan-500 selection:text-white relative overflow-x-hidden font-sans">

    <canvas id="matrix-canvas"></canvas>
    <div class="scan-beam"></div>
    <div class="vignette"></div>

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-40 bg-white/90 dark:bg-black/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 transition-colors duration-300 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-20 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="goHome()">
                <div class="p-2 bg-cyan-500/10 rounded-lg group-hover:bg-cyan-500/20 transition-colors border border-cyan-500/20">
                    <i data-lucide="terminal" class="w-6 h-6 text-cyan-600 dark:text-cyan-400"></i>
                </div>
                <div>
                    <span class="font-mono font-bold text-xl tracking-tighter text-slate-900 dark:text-white block leading-none">CYBER<span class="text-cyan-600 dark:text-cyan-400">PENTEST</span></span>
                    <span class="text-[10px] uppercase tracking-[0.2em] text-slate-500 dark:text-gray-500 font-bold">Advanced Roadmap</span>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="admin-toggle" onclick="toggleAdminMode()" class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-full border border-slate-300 dark:border-gray-700 text-xs font-bold uppercase tracking-wider hover:border-cyan-500 dark:hover:border-cyan-400 hover:text-cyan-600 dark:hover:text-cyan-400 transition-all">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span id="admin-text">View Mode</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 pt-32">
        
        <!-- Dashboard View -->
        <div id="dashboard-view" class="hidden">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-black font-mono mb-4 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-slate-900 to-slate-500 dark:from-white dark:to-gray-500 uppercase">Training Tracks</h1>
                <p class="text-lg text-slate-600 dark:text-gray-400 max-w-2xl mx-auto">Select a module to begin your journey. All progress is saved locally.</p>
                <div id="add-section-container" class="mt-8 hidden">
                    <button onclick="openModal('section')" class="px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-mono font-bold rounded-lg shadow-lg shadow-cyan-500/20 transition-all transform hover:scale-105 flex items-center gap-2 mx-auto">
                        <i data-lucide="plus-circle" class="w-5 h-5"></i> Add New Module
                    </button>
                </div>
            </div>
            <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 w-full"></div>
        </div>

        <!-- Detail View -->
        <div id="detail-view" class="hidden">
            <div class="flex items-center justify-between mb-8">
                <button onclick="goHome()" class="flex items-center gap-2 text-sm font-mono font-bold text-slate-500 dark:text-gray-400 hover:text-cyan-600 dark:hover:text-cyan-400 transition-all tracking-wide uppercase group">
                    <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> Back to Grid
                </button>
                <button id="add-category-btn" class="hidden px-4 py-2 bg-slate-100 dark:bg-gray-800 border border-slate-300 dark:border-gray-700 hover:border-cyan-500 text-slate-700 dark:text-gray-200 rounded-lg text-xs font-bold uppercase transition-all flex items-center gap-2">
                    <i data-lucide="folder-plus" class="w-4 h-4"></i> Add Category
                </button>
            </div>
            <div id="section-container" class="relative"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-5 text-center text-xs font-mono text-slate-500 dark:text-gray-600 uppercase tracking-widest border-t border-gray-200 dark:border-gray-800">
        <div class="flex justify-center items-center gap-4">
            <span class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div> System: Online</span>
            <span>|</span>
            <span>Made by Abdallah Elmohammady</span>
        </div>
    </footer>

    <!-- Modal -->
    <div id="crud-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 modal-backdrop transition-opacity" onclick="closeModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-lg max-h-[90vh] overflow-y-auto bg-white dark:bg-[#0a0a0a] border border-slate-200 dark:border-gray-800 rounded-2xl shadow-2xl p-8">
            <h3 id="modal-title" class="text-2xl font-black font-mono mb-6 text-slate-900 dark:text-white uppercase border-b border-gray-200 dark:border-gray-800 pb-4">Edit Item</h3>
            <form id="crud-form" onsubmit="handleFormSubmit(event)">
                <input type="hidden" id="item-type">
                <input type="hidden" id="item-id">
                <input type="hidden" id="parent-id">
                <input type="hidden" id="current-image">
                <div id="modal-fields" class="space-y-5"></div>
                <div class="flex justify-end gap-3 mt-8">
                    <button type="button" onclick="closeModal()" class="px-5 py-2.5 rounded-lg text-sm font-bold text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-gray-800 transition-colors">Cancel</button>
                    <button type="submit" class="px-6 py-2.5 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white text-sm font-bold shadow-lg shadow-cyan-500/20 transition-all transform hover:scale-105">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- DATA ---
        const defaultImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMWYyOTM3Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
        
        const originalSections = [
            {
                id: 'fundamentals',
                title: 'Fundamentals',
                subtitle: 'Core Technologies',
                color: 'cyan',
                icon: 'cpu',
                image: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop', 
                description: 'The foundation. Understand internal workings of computers, OS, and networks.',
                categories: [
                    {
                        id: 'cs-1', title: 'Computer Science', icon: 'cpu', color: 'cyan',
                        courses: [{ id: 'c-cs-1', title: 'CompTIA A+', link: 'https://www.youtube.com/playlist?list=PLH-n8YK76vIiDdOMRB-ylvns-_8Zl1euV', completed: false }],
                    },
                    {
                        id: 'sys-1', title: 'System Administration', icon: 'terminal', color: 'cyan',
                        courses: [
                            { id: 'c-sys-1', title: 'Windows Server 2019', link: 'https://www.youtube.com/playlist?list=PLDxVq3TlR9y2sMXaL_yLp-r6pUpevgC-w', completed: false },
                            { id: 'c-sys-2', title: 'Linux System Administration', link: 'https://www.youtube.com/playlist?list=PLy1Fx2HfcmWBpD_PI4AQpjeDK5-5q6TG7', completed: false },
                            { id: 'c-sys-3', title: 'Windows Commands / PowerShell', link: 'https://www.youtube.com/watch?v=6GPZthxEKU0', completed: false }
                        ],
                    },
                    {
                        id: 'prog-1', title: 'Programming', icon: 'code', color: 'cyan',
                        courses: [],
                        subCategories: [
                            {
                                id: 'gen-prog', title: 'General Programming', icon: 'braces',
                                courses: [
                                    { id: 'c-gp-3', title: 'C++', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAyE_gei5d18qkfIe-Z8mocs', completed: false }, 
                                    { id: 'c-gp-1', title: 'Python', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAyE_gei5d18qkfIe-Z8mocs', completed: false },
                                    { id: 'c-gp-2', title: 'Problem Solving (Python)', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAxCjHi-HIfNoZrMkfbuvVDY', completed: false }
                                ],
                            },
                            {
                                id: 'web-prog', title: 'Web Programming', icon: 'file-code',
                                courses: [
                                    { id: 'c-wp-0', title: 'HTML Crash Course', link: 'https://youtu.be/Pwatx1n1Ws0?si=CjPGkiIwMw_sfpMy', completed: false },
                                    { id: 'c-wp-1', title: 'HTML', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAw_t_XWUFbBX-c9MafPk9ji', completed: false },
                                    { id: 'c-wp-2', title: 'CSS', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAzjsz06gkzlSrlev53MGIKe', completed: false },
                                    { id: 'c-wp-3', title: 'JavaScript', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAx3kiplQR_oeDqLDBUDYwVv', completed: false },
                                    { id: 'c-wp-4', title: 'PHP Crash Course', link: 'https://youtu.be/pszZMzI9a7A?si=zOc2Kc0WGozYRygI', completed: false },
                                    { id: 'c-wp-5', title: 'PHP', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAzjsz06gkzlSrlev53MGIKe', completed: false },
                                    { id: 'c-wp-6', title: 'MySQL', link: 'https://youtu.be/N-WPYk417yE?si=n82BssSqIhK0mS0y', completed: false },
                                    { id: 'c-wp-7', title: 'Secure Web App', link: 'https://www.youtube.com/playlist?list=PLDoPjvoNmBAzjsz06gkzlSrlev53MGIKe', completed: false }
                                ],
                            },
                        ],
                    },
                    {
                        id: 'net-1', title: 'Networking', icon: 'network', color: 'cyan', 
                        courses: [
                            { id: 'c-net-1', title: 'CompTIA Network+', link: 'https://www.youtube.com/playlist?list=PLH-n8YK76vIiuIZoWvHL7AvtrDV7hR3He', completed: false },
                            { id: 'c-net-2', title: 'CCNA', link: 'https://www.youtube.com/playlist?list=PLZmPGUyBFvUrvoa-NYzcUWFpxoZR11id_', completed: false }
                        ],
                    },
                ],
            },
            {
                id: 'pentest',
                title: 'Offensive Security',
                subtitle: 'Penetration Testing',
                color: 'red',
                icon: 'shield',
                image: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?q=80&w=2070&auto=format&fit=crop', 
                description: 'Learn to think like an adversary. Master exploitation, Burp Suite, and OSCP.',
                categories: [
                    {
                        id: 'sec-1', title: 'Security Basics', icon: 'shield', color: 'red',
                        courses: [{ id: 'c-sec-1', title: 'Security+ SY0-601 Prep', link: 'https://netriders.academy/courses/security/', completed: false }],
                    },
                    {
                        id: 'pen-1', title: 'Penetration Testing', icon: 'lock', color: 'red',
                        courses: [
                            { id: 'c-pen-1', title: 'eJPTv1 Prep', link: 'https://netriders.academy/courses/penetration-testing-student', completed: false },
                            { id: 'c-pen-2', title: 'Web Application Penetration Testing Course', link: 'https://www.youtube.com/playlist?list=PLv7cogHXoVhXvHPzIl1dWtBiYUAL8baHj', completed: false }
                        ],
                    },
                    {
                        id: 'wapt-1', title: 'WAPT', icon: 'bug', color: 'red',
                        courses: [
                            { id: 'c-wap-1', title: 'Crash Course for pentest', link: 'https://youtu.be/rT9No0gdUGE?si=yWMKgOedLMvmGZIi', completed: false },
                            { id: 'c-wap-2', title: 'WAPT Course', link: 'https://www.youtube.com/playlist?list=PLX621demLUSaA7ngeN7UfVzYJihHnEfv0', completed: false }
                        ],
                    },
                    {
                        id: 'oscp-1', title: 'OSCP', icon: 'zap', color: 'red',
                        courses: [{ id: 'c-os-1', title: 'OSCP', link: 'https://www.youtube.com/playlist?list=PL5dZpxpUkHPOeYRHNLOCapZssjgwG6lVr', completed: false }],
                    },
                    {
                        id: 'ad-1', title: 'ActiveDirectory', icon: 'terminal', color: 'red',
                        courses: [{ id: 'c-ad-1', title: 'ActiveDirectory-101', link: 'https://www.youtube.com/playlist?list=PLyyAUp-Erl9WhBzp1ma2NzYQEb1nfQM1t', completed: false }],
                    },
                ],
            },
            {
                id: 'monitoring',
                title: 'Continuous Monitoring',
                subtitle: 'Security Operations',
                color: 'purple',
                icon: 'activity',
                image: 'https://images.unsplash.com/photo-1563986768494-4dee2763ff3f?q=80&w=2070&auto=format&fit=crop', 
                description: 'Protect systems, monitor for threats, and understand OWASP standards.',
                categories: [
                    {
                        id: 'ow-1', title: 'OWASP Top 10', icon: 'eye', color: 'purple',
                        courses: [{ id: 'c-ow-1', title: 'OWASP Top 10 2025', link: 'https://owasp.org/Top10/2025/', completed: false }],
                    },
                ],
            }
        ];

        let sections = JSON.parse(localStorage.getItem('cyberSections')) || JSON.parse(JSON.stringify(originalSections));
        let currentView = 'dashboard';
        let currentSectionId = null;
        let isAdminMode = false;
        let collapsedCategories = {};
        let tempImageData = null;

        // --- MATRIX ANIMATION ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        const chars = '01<>/\\[]{}ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const columns = width / 18;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            const isDark = document.documentElement.classList.contains('dark');
            ctx.fillStyle = isDark ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.8)';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = isDark ? '#0f0' : 'rgba(6, 182, 212, 0.3)';
            ctx.font = 'bold 18px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * 18, drops[i] * 18);
                if (drops[i] * 18 > height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
            requestAnimationFrame(drawMatrix);
        }
        window.addEventListener('resize', () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; });
        drawMatrix();

        function resetData() {
            if(confirm('Are you sure you want to reset all data? This will delete all custom data.')) {
                localStorage.removeItem('cyberSections');
                location.reload();
            }
        }

        function toggleAdminMode() {
            isAdminMode = !isAdminMode;
            const btn = document.getElementById('admin-toggle');
            const txt = document.getElementById('admin-text');
            const addSectionBtn = document.getElementById('add-section-container');
            const addCatBtn = document.getElementById('add-category-btn');

            if (isAdminMode) {
                btn.classList.add('border-cyan-500', 'text-cyan-600', 'dark:text-cyan-400');
                txt.innerText = 'Admin Mode';
                addSectionBtn.classList.remove('hidden');
                if(currentView !== 'dashboard') addCatBtn.classList.remove('hidden');
            } else {
                btn.classList.remove('border-cyan-500', 'text-cyan-600', 'dark:text-cyan-400');
                txt.innerText = 'View Mode';
                addSectionBtn.classList.add('hidden');
                addCatBtn.classList.add('hidden');
            }
            render();
        }

        function saveData() {
            localStorage.setItem('cyberSections', JSON.stringify(sections));
            render();
        }

        function goHome() {
            currentView = 'dashboard';
            currentSectionId = null;
            render();
        }

        function openSection(id) {
            currentView = 'detail';
            currentSectionId = id;
            render();
        }

        // --- MOVE FUNCTIONS ---
        function moveCategory(secId, catId, direction) {
            event.stopPropagation();
            const sec = sections.find(s => s.id === secId);
            if (!sec) return;
            
            const idx = sec.categories.findIndex(c => c.id === catId);
            if (idx === -1) return;
            
            const newIdx = direction === 'up' ? idx - 1 : idx + 1;
            if (newIdx < 0 || newIdx >= sec.categories.length) return;
            
            const temp = sec.categories[idx];
            sec.categories[idx] = sec.categories[newIdx];
            sec.categories[newIdx] = temp;
            saveData();
        }

        function moveCourse(catId, courseId, direction) {
            event.stopPropagation();
            let targetCat = null;
            
            for (let s of sections) {
                for (let cat of s.categories) {
                    if (cat.id === catId) { targetCat = cat; break; }
                    if (cat.subCategories) {
                        const sub = cat.subCategories.find(sub => sub.id === catId);
                        if (sub) { targetCat = sub; break; }
                    }
                }
                if (targetCat) break;
            }
            
            if (!targetCat || !targetCat.courses) return;
            
            const idx = targetCat.courses.findIndex(c => c.id === courseId);
            if (idx === -1) return;
            
            const newIdx = direction === 'up' ? idx - 1 : idx + 1;
            if (newIdx < 0 || newIdx >= targetCat.courses.length) return;
            
            const temp = targetCat.courses[idx];
            targetCat.courses[idx] = targetCat.courses[newIdx];
            targetCat.courses[newIdx] = temp;
            saveData();
        }

        // --- CRUD ---
        const findItem = (type, id) => {
            if (type === 'section') return sections.find(s => s.id === id);
            if (type === 'category') {
                for(let s of sections) {
                    const c = s.categories.find(cat => cat.id === id);
                    if(c) return { cat: c, parent: s };
                    for(let cat of s.categories) {
                        if(cat.subCategories) {
                            const sub = cat.subCategories.find(sub => sub.id === id);
                            if(sub) return { cat: sub, parent: cat, grandParent: s };
                        }
                    }
                }
            }
            if (type === 'course') {
                for(let s of sections) {
                    for(let c of s.categories) {
                        if(c.courses) {
                            let course = c.courses.find(co => co.id === id);
                            if(course) return { course, parentCat: c, parentSec: s };
                        }
                        if(c.subCategories) {
                            for(let sub of c.subCategories) {
                                if(sub.courses) {
                                    let course = sub.courses.find(co => co.id === id);
                                    if(course) return { course, parentCat: sub, parentSec: s };
                                }
                            }
                        }
                    }
                }
            }
            return null;
        };

        function deleteItem(type, id) {
            if(!confirm('Are you sure you want to delete this?')) return;
            let found = false;

            if (type === 'section') {
                const idx = sections.findIndex(s => s.id === id);
                if (idx !== -1) { sections.splice(idx, 1); found = true; if(currentSectionId === id) { goHome(); return; } }
            } 
            else if (type === 'category') {
                for (let s of sections) {
                    const catIdx = s.categories.findIndex(c => c.id === id);
                    if (catIdx !== -1) { s.categories.splice(catIdx, 1); found = true; break; }
                    if (!found) {
                        for (let cat of s.categories) {
                            if (cat.subCategories) {
                                const subIdx = cat.subCategories.findIndex(sub => sub.id === id);
                                if (subIdx !== -1) { cat.subCategories.splice(subIdx, 1); found = true; break; }
                            }
                        }
                    }
                    if (found) break;
                }
            } 
            else if (type === 'course') {
                for (let s of sections) {
                    for (let cat of s.categories) {
                        if(cat.courses) {
                            const couIdx = cat.courses.findIndex(c => c.id === id);
                            if (couIdx !== -1) { cat.courses.splice(couIdx, 1); found = true; break; }
                        }
                        if (cat.subCategories) {
                            for (let sub of cat.subCategories) {
                                if(sub.courses) {
                                    const subCouIdx = sub.courses.findIndex(c => c.id === id);
                                    if (subCouIdx !== -1) { sub.courses.splice(subCouIdx, 1); found = true; break; }
                                }
                            }
                        }
                        if (found) break;
                    }
                    if (found) break;
                }
            }
            if (found) saveData();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file (PNG, JPG, etc.)');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    tempImageData = e.target.result;
                    const preview = document.getElementById('image-preview');
                    const placeholder = document.getElementById('image-placeholder');
                    const uploadArea = document.getElementById('upload-area');
                    if(preview && placeholder) {
                        preview.src = tempImageData;
                        preview.classList.remove('hidden');
                        placeholder.classList.add('hidden');
                        uploadArea.classList.add('has-image');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function openModal(type, id = null, parentId = null) {
            const modal = document.getElementById('crud-modal');
            const fields = document.getElementById('modal-fields');
            const title = document.getElementById('modal-title');
            
            tempImageData = null;
            document.getElementById('item-type').value = type;
            document.getElementById('item-id').value = id || '';
            document.getElementById('parent-id').value = parentId || currentSectionId || '';

            fields.innerHTML = '';
            modal.classList.remove('hidden');

            let data = {};
            if (id) {
                const res = findItem(type, id);
                if(res) data = type === 'section' ? res : (type === 'category' ? res.cat : res.course);
                title.innerText = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            } else {
                title.innerText = `Add New ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            }

            document.getElementById('current-image').value = data.image || '';

            const createInput = (label, key, inputType='text', placeholder='') => `
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-gray-500 mb-2">${label}</label>
                    <input type="${inputType}" name="${key}" value="${data[key] || ''}" placeholder="${placeholder}" 
                        class="w-full bg-slate-50 dark:bg-black border border-slate-300 dark:border-gray-700 rounded-lg p-3 text-slate-900 dark:text-white focus:outline-none focus:border-cyan-500 transition-colors font-mono text-sm">
                </div>`;

            const createSelect = (label, key, options) => {
                let opts = options.map(o => `<option value="${o.val}" ${data[key] === o.val ? 'selected' : ''}>${o.txt}</option>`).join('');
                return `
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-gray-500 mb-2">${label}</label>
                    <select name="${key}" class="w-full bg-slate-50 dark:bg-black border border-slate-300 dark:border-gray-700 rounded-lg p-3 text-slate-900 dark:text-white focus:outline-none focus:border-cyan-500 transition-colors font-mono text-sm">${opts}</select>
                </div>`;
            };

            if (type === 'section') {
                fields.innerHTML += createInput('Title', 'title');
                fields.innerHTML += createInput('Subtitle', 'subtitle');
                fields.innerHTML += createInput('Description', 'description');
                fields.innerHTML += createSelect('Color Theme', 'color', [
                    {val: 'cyan', txt: 'Cyber Cyan'}, {val: 'red', txt: 'Offensive Red'}, {val: 'purple', txt: 'Deep Purple'}
                ]);
                fields.innerHTML += createSelect('Icon', 'icon', [
                    {val: 'cpu', txt: 'CPU'}, {val: 'shield', txt: 'Shield'}, {val: 'bug', txt: 'Bug'}, 
                    {val: 'terminal', txt: 'Terminal'}, {val: 'lock', txt: 'Lock'}, {val: 'eye', txt: 'Eye'}, {val: 'activity', txt: 'Activity'}
                ]);
                
                const currentImg = data.image || '';
                fields.innerHTML += `
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-gray-500 mb-2">Cover Image (PNG/JPG)</label>
                    <div id="upload-area" class="img-upload-area ${currentImg ? 'has-image' : ''}" onclick="document.getElementById('img-upload').click()">
                        <input type="file" id="img-upload" accept="image/png,image/jpeg,image/jpg,image/webp" class="hidden" onchange="handleImageUpload(event)">
                        <img id="image-preview" src="${currentImg}" class="${currentImg ? '' : 'hidden'} w-full h-40 object-cover rounded-lg mb-2">
                        <div id="image-placeholder" class="${currentImg ? 'hidden' : ''} py-8">
                            <i data-lucide="upload" class="w-10 h-10 mx-auto text-slate-400 mb-2"></i>
                            <p class="text-sm text-slate-500">Click to upload image</p>
                            <p class="text-xs text-slate-400 mt-1">PNG, JPG, WEBP supported</p>
                        </div>
                    </div>
                    <button type="button" onclick="removeImage()" class="mt-2 text-xs text-rose-500 hover:underline ${currentImg ? '' : 'hidden'}" id="remove-img-btn">Remove Image</button>
                </div>`;
            } 
            else if (type === 'category') {
                fields.innerHTML += createInput('Category Name', 'title');
                fields.innerHTML += createSelect('Icon', 'icon', [
                    {val: 'folder', txt: 'Folder'}, {val: 'book', txt: 'Book'}, {val: 'code', txt: 'Code'}, 
                    {val: 'list', txt: 'List'}, {val: 'cpu', txt: 'CPU'}, {val: 'terminal', txt: 'Terminal'}, 
                    {val: 'network', txt: 'Network'}, {val: 'shield', txt: 'Shield'}, {val: 'lock', txt: 'Lock'}, 
                    {val: 'bug', txt: 'Bug'}, {val: 'eye', txt: 'Eye'}, {val: 'zap', txt: 'Zap'}
                ]);
            }
            else if (type === 'course') {
                fields.innerHTML += createInput('Course Title', 'title');
                fields.innerHTML += createInput('Resource Link', 'link', 'url', 'https://...');
            }
            
            lucide.createIcons();
        }

        function removeImage() {
            tempImageData = 'REMOVED';
            const preview = document.getElementById('image-preview');
            const placeholder = document.getElementById('image-placeholder');
            const uploadArea = document.getElementById('upload-area');
            const removeBtn = document.getElementById('remove-img-btn');
            if(preview) { preview.classList.add('hidden'); preview.src = ''; }
            if(placeholder) placeholder.classList.remove('hidden');
            if(uploadArea) uploadArea.classList.remove('has-image');
            if(removeBtn) removeBtn.classList.add('hidden');
        }

        function closeModal() {
            document.getElementById('crud-modal').classList.add('hidden');
            tempImageData = null;
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const type = document.getElementById('item-type').value;
            const id = document.getElementById('item-id').value;
            const parentId = document.getElementById('parent-id').value;
            const currentImage = document.getElementById('current-image').value;

            if (type === 'section') {
                let finalImage = currentImage || defaultImage;
                if (tempImageData === 'REMOVED') finalImage = defaultImage;
                else if (tempImageData) finalImage = tempImageData;

                if (id) {
                    const sec = sections.find(s => s.id === id);
                    if(sec) {
                        sec.title = formData.get('title') || sec.title;
                        sec.subtitle = formData.get('subtitle') || sec.subtitle;
                        sec.description = formData.get('description') || sec.description;
                        sec.color = formData.get('color') || sec.color;
                        sec.icon = formData.get('icon') || sec.icon;
                        sec.image = finalImage;
                    }
                } else {
                    sections.push({
                        id: 'sec_' + Date.now(),
                        title: formData.get('title') || 'New Module',
                        subtitle: formData.get('subtitle') || 'Subtitle',
                        description: formData.get('description') || 'Description',
                        color: formData.get('color') || 'cyan',
                        icon: formData.get('icon') || 'cpu',
                        image: finalImage,
                        categories: []
                    });
                }
            } else if (type === 'category') {
                const sec = sections.find(s => s.id === parentId);
                if (!sec) { alert("Error: Section not found."); closeModal(); return; }

                if (id) {
                    const res = findItem('category', id);
                    if(res && res.cat) {
                        res.cat.title = formData.get('title') || res.cat.title;
                        res.cat.icon = formData.get('icon') || res.cat.icon;
                    }
                } else {
                    sec.categories.push({
                        id: 'cat_' + Date.now(),
                        title: formData.get('title') || 'New Category',
                        icon: formData.get('icon') || 'folder',
                        color: sec.color,
                        courses: []
                    });
                }
            } else if (type === 'course') {
                let targetCategory = null;
                for (let s of sections) {
                    for(let cat of s.categories) {
                        if (cat.id === parentId) { targetCategory = cat; break; }
                        if (cat.subCategories) {
                            let sub = cat.subCategories.find(sub => sub.id === parentId);
                            if (sub) { targetCategory = sub; break; }
                        }
                    }
                    if (targetCategory) break;
                }
                if (!targetCategory) { alert("Error: Category not found."); closeModal(); return; }
                if(!targetCategory.courses) targetCategory.courses = [];

                if (id) {
                    const course = targetCategory.courses.find(c => c.id === id);
                    if (course) {
                        course.title = formData.get('title') || course.title;
                        course.link = formData.get('link') || course.link;
                    }
                } else {
                    targetCategory.courses.push({
                        id: 'cou_' + Date.now(),
                        title: formData.get('title') || 'New Course',
                        link: formData.get('link') || '#',
                        completed: false
                    });
                }
            }
            
            saveData();
            closeModal();
        }

        // --- RENDER ---
        const themeColors = (color) => {
            const map = {
                cyan: 'text-cyan-600 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/20 border-cyan-200 dark:border-cyan-900/50',
                red: 'text-rose-600 dark:text-rose-400 bg-rose-50 dark:bg-rose-900/20 border-rose-200 dark:border-rose-900/50',
                purple: 'text-violet-600 dark:text-violet-400 bg-violet-50 dark:bg-violet-900/20 border-violet-200 dark:border-violet-900/50'
            };
            return map[color] || map.cyan;
        };

        const render = () => {
            const appDashboard = document.getElementById('dashboard-view');
            const appDetail = document.getElementById('detail-view');
            const cardsContainer = document.getElementById('cards-container');
            const sectionContainer = document.getElementById('section-container');
            const addCatBtn = document.getElementById('add-category-btn');

            if (currentView === 'dashboard') {
                appDashboard.classList.remove('hidden');
                appDetail.classList.add('hidden');
                cardsContainer.innerHTML = '';

                sections.forEach(sec => {
                    const styles = themeColors(sec.color);
                    const card = document.createElement('div');
                    card.className = 'group relative w-full rounded-2xl overflow-hidden border border-slate-200 dark:border-gray-800 bg-white dark:bg-[#050505] shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col h-full cursor-pointer';
                    card.onclick = (e) => { if(!e.target.closest('.admin-btn')) openSection(sec.id); };

                    let adminHtml = '';
                    if(isAdminMode) {
                        adminHtml = `
                            <div class="absolute top-3 right-3 z-20 flex gap-2 admin-btn">
                                <button onclick="event.stopPropagation(); openModal('section', '${sec.id}')" class="p-2 bg-white/90 dark:bg-black/90 rounded-lg shadow hover:bg-cyan-50 dark:hover:bg-cyan-900/50 text-slate-700 dark:text-slate-300 hover:text-cyan-600 transition-colors"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                                <button onclick="event.stopPropagation(); deleteItem('section', '${sec.id}')" class="p-2 bg-white/90 dark:bg-black/90 rounded-lg shadow hover:bg-rose-50 dark:hover:bg-rose-900/50 text-slate-700 dark:text-slate-300 hover:text-rose-600 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            </div>`;
                    }

                    card.innerHTML = `
                        ${adminHtml}
                        <div class="w-full h-48 overflow-hidden relative bg-gray-100 dark:bg-gray-900">
                            <img src="${sec.image || defaultImage}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700" alt="${sec.title}" onerror="this.src='${defaultImage}'">
                            <div class="absolute inset-0 bg-gradient-to-t from-slate-900/60 to-transparent"></div>
                        </div>
                        <div class="p-6 flex flex-col flex-1 relative">
                            <div class="mb-4 p-3 w-fit rounded-xl ${styles}"><i data-lucide="${sec.icon}" class="w-6 h-6"></i></div>
                            <h2 class="text-2xl font-black font-mono text-slate-900 dark:text-white mb-2 uppercase tracking-tight">${sec.title}</h2>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">${sec.subtitle}</p>
                            <p class="text-sm text-slate-600 dark:text-gray-400 line-clamp-3 mb-6 flex-1">${sec.description}</p>
                            <div class="mt-auto flex items-center text-sm font-bold text-slate-500 group-hover:text-cyan-500 dark:text-gray-500 dark:group-hover:text-cyan-400 transition-colors gap-2">
                                View Modules <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </div>
                        </div>`;
                    cardsContainer.appendChild(card);
                });
            } else {
                appDashboard.classList.add('hidden');
                appDetail.classList.remove('hidden');
                sectionContainer.innerHTML = '';

                const sec = sections.find(s => s.id === currentSectionId);
                if(!sec) return goHome();

                if(isAdminMode) { addCatBtn.classList.remove('hidden'); addCatBtn.onclick = () => openModal('category', null, currentSectionId); }
                else { addCatBtn.classList.add('hidden'); addCatBtn.onclick = null; }

                const styles = themeColors(sec.color);
                const header = document.createElement('div');
                header.className = 'mb-8 rounded-2xl border border-slate-200 dark:border-gray-800 bg-white dark:bg-[#050505] overflow-hidden shadow-xl';
                header.innerHTML = `
                    <div class="p-8 flex flex-col md:flex-row items-start md:items-center gap-6 relative">
                        ${isAdminMode ? `<div class="absolute top-4 right-4 flex gap-2 admin-btn">
                            <button onclick="openModal('section', '${sec.id}')" class="p-2 rounded hover:bg-slate-100 dark:hover:bg-gray-800 text-slate-400"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                            <button onclick="deleteItem('section', '${sec.id}')" class="p-2 rounded hover:bg-rose-50 dark:hover:bg-rose-900/20 text-rose-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>` : ''}
                        <div class="p-4 rounded-xl ${styles} shrink-0"><i data-lucide="${sec.icon}" class="w-8 h-8"></i></div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-black font-mono text-slate-900 dark:text-white uppercase tracking-tight">${sec.title}</h2>
                            <p class="text-sm font-bold text-slate-500 uppercase tracking-widest mt-1">${sec.subtitle}</p>
                        </div>
                    </div>
                    <div class="px-8 py-6 bg-slate-50 dark:bg-[#080808] border-t border-slate-200 dark:border-gray-800">
                        <p class="text-slate-600 dark:text-gray-400 leading-relaxed">${sec.description}</p>
                    </div>`;
                sectionContainer.appendChild(header);

                sec.categories.forEach((cat, catIndex) => {
                    const isCollapsed = collapsedCategories[cat.id];
                    const catBox = document.createElement('div');
                    catBox.className = 'mb-8 rounded-xl border border-slate-200 dark:border-gray-800 bg-white dark:bg-[#050505] overflow-hidden shadow-sm';

                    const isFirstCat = catIndex === 0;
                    const isLastCat = catIndex === sec.categories.length - 1;

                    let catHeader = `<div class="p-5 md:p-6 flex justify-between items-center cursor-pointer select-none hover:bg-slate-50 dark:hover:bg-[#0a0a0a] transition-colors" onclick="toggleCollapse('${cat.id}')">
                        <div class="flex items-center gap-4">`;
                    
                    // أزرار تحريك الـ Category (ظاهرة دائماً في Admin Mode)
                    if(isAdminMode) {
                        catHeader += `
                            <div class="reorder-controls" onclick="event.stopPropagation()">
                                <button onclick="moveCategory('${sec.id}', '${cat.id}', 'up')" class="move-btn" ${isFirstCat ? 'disabled' : ''} title="Move Up">
                                    <i data-lucide="arrow-up" class="w-4 h-4"></i>
                                </button>
                                <button onclick="moveCategory('${sec.id}', '${cat.id}', 'down')" class="move-btn" ${isLastCat ? 'disabled' : ''} title="Move Down">
                                    <i data-lucide="arrow-down" class="w-4 h-4"></i>
                                </button>
                            </div>`;
                    }
                    
                    catHeader += `
                            <i data-lucide="${isCollapsed ? 'chevron-right' : 'chevron-down'}" class="w-5 h-5 text-slate-400"></i>
                            <div class="p-2 rounded-lg bg-slate-100 dark:bg-gray-900 text-slate-700 dark:text-gray-300"><i data-lucide="${cat.icon}" class="w-5 h-5"></i></div>
                            <h3 class="text-xl font-bold text-slate-800 dark:text-gray-100">${cat.title}</h3>
                            <span class="text-xs px-2 py-1 rounded bg-slate-200 dark:bg-gray-800 text-slate-600 dark:text-gray-400 font-mono hidden md:inline-block">
                                ${cat.courses ? cat.courses.length : 0}${cat.subCategories ? ' (+ Subs)' : ''}
                            </span>
                        </div>`;

                    if(isAdminMode) {
                        catHeader += `<div class="flex items-center gap-2 admin-btn ml-4" onclick="event.stopPropagation()">
                            <button onclick="openModal('course', null, '${cat.id}')" class="flex items-center gap-1 px-3 py-1.5 bg-cyan-600 text-white text-xs font-bold rounded hover:bg-cyan-500"><i data-lucide="plus" class="w-3 h-3"></i> Add</button>
                            <button onclick="openModal('category', '${cat.id}', '${sec.id}')" class="p-1.5 rounded hover:bg-slate-200 dark:hover:bg-gray-800 text-slate-400"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                            <button onclick="deleteItem('category', '${cat.id}')" class="p-1.5 rounded hover:bg-rose-50 dark:hover:bg-rose-900/20 text-rose-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    }
                    catHeader += `</div>`;
                    catBox.innerHTML = catHeader;

                    if(!isCollapsed) {
                        const listContainer = document.createElement('div');
                        listContainer.className = 'divide-y divide-slate-100 dark:divide-gray-900 bg-slate-50/30 dark:bg-[#050505]/50';

                        if(cat.courses && cat.courses.length > 0) {
                            cat.courses.forEach((c, idx) => renderCourseRow(listContainer, c, cat.id, sec.id, idx, cat.courses.length));
                        }

                        if(cat.subCategories && cat.subCategories.length > 0) {
                            cat.subCategories.forEach(sub => {
                                const subHeader = document.createElement('div');
                                subHeader.className = 'px-6 py-3 bg-slate-100 dark:bg-[#080808] border-b border-slate-200 dark:border-gray-800 text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center justify-between';
                                let subHeaderContent = `<div class="flex items-center gap-2"><i data-lucide="${sub.icon}" class="w-4 h-4"></i> ${sub.title}</div>`;
                                if(isAdminMode) {
                                    subHeaderContent += `<div class="flex gap-2 admin-btn" onclick="event.stopPropagation()">
                                        <button onclick="openModal('course', null, '${sub.id}')" class="text-[10px] flex items-center gap-1 px-2 py-1 bg-white dark:bg-gray-700 border border-slate-300 dark:border-gray-600 rounded hover:text-cyan-600"><i data-lucide="plus" class="w-3 h-3"></i> Add</button>
                                        <button onclick="deleteItem('category', '${sub.id}')" class="text-rose-500 hover:underline"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                                    </div>`;
                                }
                                subHeader.innerHTML = subHeaderContent;
                                listContainer.appendChild(subHeader);
                                if(sub.courses) sub.courses.forEach((c, idx) => renderCourseRow(listContainer, c, sub.id, sec.id, idx, sub.courses.length));
                            });
                        }

                        if((!cat.courses || cat.courses.length === 0) && (!cat.subCategories || cat.subCategories.length === 0)) {
                            listContainer.innerHTML = `<div class="p-8 text-center text-slate-400 text-sm italic">No courses yet.</div>`;
                        }
                        catBox.appendChild(listContainer);
                    }
                    sectionContainer.appendChild(catBox);
                });
            }
            lucide.createIcons();
        };

        function renderCourseRow(container, c, parentId, secId, index, total) {
            const row = document.createElement('div');
            row.className = 'group p-5 flex flex-col md:flex-row md:items-center justify-between gap-4 hover:bg-slate-50 dark:hover:bg-[#0a0a0a] transition-colors relative';
            
            const isFirst = index === 0;
            const isLast = index === total - 1;
            
            let moveButtons = '';
            if(isAdminMode) {
                moveButtons = `
                    <div class="reorder-controls flex-row" style="flex-direction: row; margin-right: 8px;">
                        <button onclick="moveCourse('${parentId}', '${c.id}', 'up')" class="move-btn" ${isFirst ? 'disabled' : ''} title="Move Up">
                            <i data-lucide="arrow-up" class="w-3 h-3"></i>
                        </button>
                        <button onclick="moveCourse('${parentId}', '${c.id}', 'down')" class="move-btn" ${isLast ? 'disabled' : ''} title="Move Down">
                            <i data-lucide="arrow-down" class="w-3 h-3"></i>
                        </button>
                    </div>`;
            }
            
            row.innerHTML = `
                <div class="flex items-center gap-3 flex-1 min-w-0">
                    ${moveButtons}
                    <button onclick="toggleComplete('${secId}', '${parentId}', '${c.id}')" class="shrink-0 w-6 h-6 rounded border ${c.completed ? 'bg-cyan-500 border-cyan-500 text-white' : 'border-slate-300 dark:border-gray-600 text-transparent'} flex items-center justify-center transition-all hover:border-cyan-500">
                        <i data-lucide="check" class="w-4 h-4"></i>
                    </button>
                    <span class="text-base font-medium truncate ${c.completed ? 'text-slate-400 line-through' : 'text-slate-700 dark:text-gray-200'}">${c.title}</span>
                </div>
                <div class="flex items-center gap-4 w-full md:w-auto justify-end">
                    <a href="${c.link}" target="_blank" class="shrink-0 flex-1 md:flex-none text-center px-4 py-2 rounded-lg bg-white dark:bg-gray-900 border border-slate-200 dark:border-gray-700 text-cyan-600 dark:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/20 transition-all text-sm font-bold">
                        Open Resource <i data-lucide="external-link" class="w-4 h-4 inline ml-1"></i>
                    </a>
                </div>`;
            if(isAdminMode) {
                row.innerHTML += `<div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity admin-btn md:right-[130px] bg-white dark:bg-black pl-2">
                    <button onclick="openModal('course', '${c.id}', '${parentId}')" class="p-1 text-slate-400 hover:text-cyan-600"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                    <button onclick="deleteItem('course', '${c.id}')" class="p-1 text-slate-400 hover:text-rose-600"><i data-lucide="trash" class="w-4 h-4"></i></button>
                </div>`;
            }
            container.appendChild(row);
        }

        function toggleCollapse(id) { collapsedCategories[id] = !collapsedCategories[id]; render(); }

        function toggleComplete(secId, catId, couId) {
            const sec = sections.find(s => s.id === secId);
            if(!sec) return;
            const findAndToggle = (cats) => {
                for(let cat of cats) {
                    if(cat.id === catId && cat.courses) {
                        const c = cat.courses.find(x => x.id === couId);
                        if(c) { c.completed = !c.completed; return true; }
                    }
                    if(cat.subCategories) { if(findAndToggle(cat.subCategories)) return true; }
                }
                return false;
            };
            findAndToggle(sec.categories);
            saveData();
        }

        render();
    </script>
</body></html>
